name: boss
components:
  ai_tag: {}
  ai:
    move_speed: 1.6
    follow_range: 0
    attack_range: 64
    attack_frames: 90
  ai_state: {}
  ai_context: {}
  ai_config:
    spec:
      initial: idle
      states:
        idle:
          on_enter:
            - set_animation: idle
          while:
            - stop_x: true
        intro:
          on_enter:
            - set_animation: idle
            - start_timer: 3.0
            - stop_player_input: true
          while:
            - stop_x: true
            - tick_timer: true
          on_exit:
            - restore_player_input: true
        follow:
          on_enter:
            - set_animation: run
          while:
            - move_towards_player: true
            - face_player: true
        attack_regular:
          on_enter:
            - set_animation: attack_regular
            - start_attack_timer: true
            - play_audio: attack
          while:
            - stop_x: true
            - tick_timer: true
            - face_player: true
        attack_overhead:
          on_enter:
            - set_animation: attack_overhead
            - start_attack_timer: true
            - play_audio: attack
          while:
            - stop_x: true
            - tick_timer: true
            - face_player: true
        death:
          on_enter:
            - set_animation: death
            - play_audio: death
            - disable_hazard: true
          while:
            - stop_x: true
        hit:
          on_enter:
            - start_timer: 0.0
            - add_white_flash: 20
            - play_audio: hit
            - print: "Boss entered hit state"
          while:
            - tick_timer: true
      transitions:
        idle:
          - sees_player && timer_expired: follow
          - phase_intro: intro
          - hit: hit
          - out_of_health:
              to: death
        intro:
          - timer_expired: idle
          - hit: hit
          - out_of_health:
              to: death
        follow:
          - loses_player: idle
          - in_attack_range: attack_regular
          - hit: hit
          - out_of_health:
              to: death
        attack_regular:
          - timer_expired: follow
          - loses_player: idle
          - hit: hit
          - out_of_health:
              to: death
        attack_overhead:
          - timer_expired: follow
          - loses_player: idle
          - hit: hit
          - out_of_health:
              to: death
        hit:
          - out_of_health: death
          - timer_expired: idle

  ai_phase_controller:
    reset_state_on_phase_change: true
    phases:

      - name: phase_1
        start_when:
          - player_in_range: 300
        on_enter:
          - set_ai:
              move_speed: 1.8
              follow_range: 650
              attack_range: 60
              attack_frames: 30
          - arena_set_active:
              group: boss_gate
              active: true
          - stop_player_input: true
          - play_audio: roar
          - camera_shake:
              frames: 180
              intensity: 6.0
          - emit_event: phase_intro

      - name: phase_2
        start_when:
          - hp_lte: 18
        transition_overrides:
          follow:
            - loses_player: idle
            - in_attack_range: attack_overhead
            - out_of_health:
                to: death
        on_enter:
          - set_ai:
              move_speed: 2.5
              attack_range: 84
              attack_frames: 55
          - arena_set_hazard:
              group: arena_spikes
              enabled: true

      - name: phase_3
        start_when:
          - hp_lte: 8
        transition_overrides:
          follow:
            - loses_player: idle
            - in_attack_range: attack_regular
            - out_of_health:
                to: death
          attack_regular:
            - timer_expired: attack_overhead
            - loses_player: idle
            - out_of_health:
                to: death
          attack_overhead:
            - timer_expired: attack_regular
            - loses_player: idle
            - out_of_health:
                to: death
        on_enter:
          - set_ai:
              move_speed: 3.0
              follow_range: 900
              attack_range: 96
              attack_frames: 45
          - arena_set_hazard:
              group: arena_spikes
              enabled: true
          - arena_set_transition:
              group: boss_exit
              enabled: false
  transform:
    x: 0
    y: 0
    scale_x: 1
    scale_y: 1
    rotation: 0
  sprite:
    use_source: false
    origin_x: 0
    origin_y: 0
    facing_left: true
  render_layer:
    index: 95
  animation:
    sheet: forsaken_scion-Sheet.png
    current: idle
    defs:
      idle:
        row: 0
        col_start: 0
        frame_count: 4
        frame_w: 128
        frame_h: 128
        fps: 8
        loop: true
      run:
        row: 1
        col_start: 0
        frame_count: 3
        frame_w: 128
        frame_h: 128
        fps: 10
        loop: true
      attack_regular:
        row: 2
        col_start: 0
        frame_count: 5
        frame_w: 128
        frame_h: 128
        fps: 10
        loop: false
      attack_overhead:
        row: 3
        col_start: 0
        frame_count: 7
        frame_w: 128
        frame_h: 128
        fps: 12
        loop: true
      death:
        row: 4
        col_start: 0
        frame_count: 14
        frame_w: 128
        frame_h: 128
        fps: 10
        loop: false
    playing: true
  audio:
    clips:
      - name: roar 
        file: robotic_monster_roar.wav 
        volume: 1.0
      - name: attack
        file: enemy_attack.wav
        volume: 1.0
      - name: hit
        file: enemy_hit.wav
        volume: 1.0
      - name: death
        file: enemy_death.wav
        volume: 1.0
  physics_body:
    width: 50
    height: 100
    offset_x: 36
    offset_y: 24
    mass: 1
    friction: 0.2
    elasticity: 0
    align_top_left: true
    scale_with_transform: true
  hazard:
    width: 50
    height: 80
    offset_x: 36
    offset_y: 48
    scale_with_transform: true
  health:
    initial: 30
  hitboxes:
    - width: 64
      height: 32
      offset_x: 36
      offset_y: 24
      damage: 1
      anim: attack_regular
      frames: [4]
  hurtboxes:
    - width: 50
      height: 100
      offset_x: 36
      offset_y: 24
