name: enemy
move_speed: 2.5
follow_range: 400
attack_range: 25
attack_frames: 65
transform:
  x: 0
  y: 0
  scale_x: 1
  scale_y: 1
  rotation: 0
sprite: &enemy_sprite
  use_source: false
  origin_x: 0
  origin_y: 0
collider:
  width: 32
  height: 40
  offsetX: 15
  offsetY: 15
render_layer:
  index: 90
health: 2
animation: &enemy_animation
  sheet: enemy-Sheet.png
  current: idle
  defs:
    idle:
      name: idle
      row: 0
      col_start: 0
      frame_count: 1
      frame_w: 64
      frame_h: 64
      fps: 8
      loop: true
    run:
      name: run
      row: 1
      col_start: 0
      frame_count: 5
      frame_w: 64
      frame_h: 64
      fps: 8
      loop: true
    attack:
      name: attack
      row: 2
      col_start: 0
      frame_count: 15
      frame_w: 64
      frame_h: 64
      fps: 10
      loop: false
    hit:
      name: hit
      row: 3
      col_start: 0
      frame_count: 2
      frame_w: 64
      frame_h: 64
      fps: 6
      loop: false
    death:
      name: death
      row: 4
      col_start: 0
      frame_count: 8
      frame_w: 64
      frame_h: 64
      fps: 10
      loop: false
audio:
  - name: attack
    file: enemy_attack.wav
    volume: 1.0
  - name: hit
    file: enemy_hit.wav
    volume: 1.0
  - name: death
    file: enemy_death.wav
    volume: 1.0
fsm: &enemy_fsm
  initial: idle
  states:
    idle:
      on_enter:
        - set_animation: idle
        - print: "Enemy entered idle state"
      while:
        - stop_x: true
    follow:
      on_enter:
        - set_animation: run
        - print: "Enemy entered follow state"
      while:
        - move_towards_player: true
        - face_player: true
    attack:
      on_enter:
        - set_animation: attack
        - start_timer: 1.5
        - play_audio: attack
        - print: "Enemy entered attack state"
      while:
        - stop_x: true
        - tick_timer: true
      on_exit:
        - stop_audio: attack
    hit:
      on_enter:
        - set_animation: hit
        - start_timer: 0.15
        - add_white_flash: 20
        - add_invulnerable: true
        - play_audio: hit
        - print: "Enemy entered hit state"
      while:
        - tick_timer: true
      on_exit:
        - remove_invulnerable: true
    death:
      on_enter:
        - set_animation: death
        - start_timer: 2.0
        - add_invulnerable: true 
        - play_audio: death
        - disable_hazard: true
      while:
        - tick_timer: true
      on_exit:
        - destroy_self: true
    destroy:
  transitions:
    idle:
      - sees_player_and_not_reached_edge: follow
      - hit: hit
    follow:
      - loses_player: idle
      - in_attack_range: attack
      - hit: hit
      - reached_edge: idle
    attack:
      - timer_expired: follow
      - loses_player: idle
      - hit: hit
    hit:
      - out_of_health: death
      - timer_expired: idle
    death:
      - timer_expired: destroy

# Combat boxes for enemy
hitboxes: &enemy_hitboxes
  - width: 48
    height: 24
    offset_x: 30
    offset_y: 20
    damage: 1
    anim: attack
    frames: [10]

hurtboxes: &enemy_hurtboxes
  - width: 32
    height: 40
    offset_x: 15
    offset_y: 15

components:
  ai_tag: {}
  ai:
    move_speed: 2.5
    follow_range: 400
    attack_range: 25
    attack_frames: 65
  pathfinding:
    grid_size: 32
    repath_frames: 15
    debug_node_size: 3
  ai_state: {}
  ai_context: {}
  ai_config:
    spec: *enemy_fsm
  transform:
    x: 0
    y: 0
    scale_x: 1
    scale_y: 1
    rotation: 0
  sprite: *enemy_sprite
  render_layer:
    index: 90
  animation: *enemy_animation
  audio:
    clips:
      - name: attack
        file: enemy_attack.wav
        volume: 1.0
      - name: hit
        file: enemy_hit.wav
        volume: 1.0
      - name: death
        file: enemy_death.wav
        volume: 1.0
  physics_body:
    width: 32
    height: 40
    offset_x: 15
    offset_y: 15
    mass: 1
    friction: 0.2
    elasticity: 0
    align_top_left: true
    scale_with_transform: true
  health:
    initial: 2
  hitboxes: *enemy_hitboxes
  hurtboxes: *enemy_hurtboxes
  hazard:
    width: 32
    height: 40
    offset_x: 15
    offset_y: 15
    scale_with_transform: true
  ai_navigation: {}